
# totem gst-inspect requires a machine id (generated by dbus). we
# don't have one yet because we are in a virgin chroot. fake one
preinstall:
	mkdir -p "$(CHROOT)/var/lib/dbus"
	echo 1234567890abcdef1234567890abcdef > \
		"$(CHROOT)"/var/lib/dbus/machine-id
	chroot "$(CHROOT)" $(EMERGE) $(USEPKG) -1n dev-util/pkgconfig
ifeq ($(OVERLAY),YES)
	chroot $(CHROOT) $(EMERGE) $(USEPKG) -1n app-portage/layman
	chroot $(CHROOT) $(EMERGE) $(USEPKG) -1n dev-vcs/git
	chroot $(CHROOT) /usr/bin/layman --sync ALL
	chroot $(CHROOT) /usr/bin/layman --add gnome
	echo "source /var/lib/layman/make.conf" >> $(CHROOT)/etc/make.conf
	echo USE='"$$USE clutter"' >> $(CHROOT)/etc/make.conf
endif

postinstall: custom.conf gdm.start
	$(RM) "$(CHROOT)"/var/lib/dbus/machine-id
	cp custom.conf "$(CHROOT)"/etc/X11/gdm/custom.conf
	ln -sf /etc/init.d/dbus "$(CHROOT)/etc/runlevels/default/dbus"
	cp gdm.start "$(CHROOT)/etc/local.d/gdm.start"

clean:

