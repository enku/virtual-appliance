
ifneq ($(OVERLAY),YES)
	DO_OVERLAY = \#
endif

# totem gst-inspect requires a machine id (generated by dbus). we
# don't have one yet because we are in a virgin chroot. fake one
preinstall:
	mkdir -p "$(CHROOT)/var/lib/dbus"
	echo 1234567890abcdef1234567890abcdef > \
		"$(CHROOT)"/var/lib/dbus/machine-id
	chroot "$(CHROOT)" $(EMERGE) $(USEPKG)-1n dev-util/pkgconfig
	$(DO_OVERLAY) chroot $(CHROOT) $(EMERGE) $(USEPKG) -1n app-portage/layman
	$(DO_OVERLAY) chroot $(CHROOT) $(EMERGE) $(USEPKG) -1n dev-vcs/git
	$(DO_OVERLAY) chroot $(CHROOT) /usr/bin/layman --sync ALL
	$(DO_OVERLAY) chroot $(CHROOT) /usr/bin/layman --add gnome
	$(DO_OVERLAY) echo "source /var/lib/layman/make.conf" >> $(CHROOT)/etc/make.conf
	$(DO_OVERLAY) echo USE='"$$USE clutter"' >> $(CHROOT)/etc/make.conf

postinstall: custom.conf
	$(RM) "$(CHROOT)"/var/lib/dbus/machine-id
	cp custom.conf "$(CHROOT)"/etc/X11/gdm/custom.conf
	#chroot "$(CHROOT)" rc-update add hald default
	echo 'gdm &>/dev/null' >> "$(CHROOT)"/etc/conf.d/local.start

clean:

