OVERLAY = NO

# totem gst-inspect requires a machine id (generated by dbus). we
# don't have one yet because we are in a virgin chroot. fake one
preinstall = mkdir -p "$(CHROOT)/var/lib/dbus";                           \
	echo 1234567890abcdef1234567890abcdef                                 \
	> "$(CHROOT)"/var/lib/dbus/machine-id;                                \
	chroot "$(CHROOT)" emerge -1n dev-util/pkgconfig;                     \
	if [ "$(OVERLAY)" == "YES" ] ; then                                   \
		chroot $(CHROOT) emerge -1n app-portage/layman;                   \
		chroot $(CHROOT) emerge -1n dev-vcs/git;                          \
		chroot $(CHROOT) /usr/bin/layman --sync ALL;                      \
		chroot $(CHROOT) /usr/bin/layman --add gnome;                     \
		echo "source /var/lib/layman/make.conf" >>                        \
			$(CHROOT)/etc/make.conf;                                      \
        echo USE='"$$USE clutter"' >> $(CHROOT)/etc/make.conf;              \
	fi;

postinstall = rm -f "$(CHROOT)"/var/lib/dbus/machine-id;                  \
	cp "$(APPLIANCE)"/custom.conf "$(CHROOT)"/etc/X11/gdm/custom.conf;    \
	chroot "$(CHROOT)" rc-update add hald default;                        \
	echo 'gdm &>/dev/null' >> "$(CHROOT)"/etc/conf.d/local.start;
